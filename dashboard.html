<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Digital Kecamatan Papar</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        /* Base Styles with Glassmorphism */
        :root {
            --primary: #27ae60;
            --primary-light: #2ecc71;
            --primary-dark: #219653;
            --secondary: #3498db;
            --danger: #e74c3c;
            --warning: #f39c12;
            --dark: #2c3e50;
            --darker: #1a252f;
            --light: #ecf0f1;
            --lighter: #f8f9fa;
            --gray: #95a5a6;
            --glass-blur: blur(12px);
            --glass-border: 1px solid rgba(255, 255, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4f1fe 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            background-image: url('https://images.unsplash.com/photo-1600585154340-be6161a56a0c?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
        }

        .container {
            display: flex;
            min-height: 100vh;
            backdrop-filter: blur(2px);
        }

        /* Sidebar Styles with Glassmorphism */
        .sidebar {
            width: 280px;
            background: rgba(44, 62, 80, 0.8);
            color: white;
            transition: all 0.3s ease;
            backdrop-filter: var(--glass-blur);
            border-right: var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }

        .sidebar-header {
            padding: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-header img {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }

        .sidebar-header h2 {
            font-weight: 600;
            font-size: 1.3rem;
            background: linear-gradient(to right, var(--primary-light), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            color: transparent;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .sidebar-menu ul {
            list-style: none;
        }

        .sidebar-menu li {
            padding: 14px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            margin: 5px 10px;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .sidebar-menu li::before {
            content: '';
            position: absolute;
            left: -100%;
            top: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: 0.5s;
        }

        .sidebar-menu li:hover::before {
            left: 100%;
        }

        .sidebar-menu li:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .sidebar-menu li.active {
            background: linear-gradient(90deg, rgba(39, 174, 96, 0.3), rgba(39, 174, 96, 0.1));
            box-shadow: 0 0 10px rgba(39, 174, 96, 0.2);
        }

        .sidebar-menu li.active::after {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: var(--primary);
        }

        .sidebar-menu li i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            position: absolute;
            bottom: 0;
            width: 280px;
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* Top Bar with Glassmorphism */
        .top-bar {
            background: rgba(255, 255, 255, 0.8);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: var(--glass-blur);
            border-bottom: var(--glass-border);
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
            position: relative;
            z-index: 10;
        }

        .search-box {
            position: relative;
            width: 350px;
        }

        .search-box input {
            padding: 10px 20px 10px 45px;
            border-radius: 30px;
            border: none;
            width: 100%;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .search-box input:focus {
            outline: none;
            box-shadow: 0 2px 15px rgba(39, 174, 96, 0.2);
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            position: relative;
        }

        .user-info img {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
            transition: all 0.3s ease;
        }

        .user-info:hover img {
            transform: scale(1.05);
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.3);
        }

        .user-info span {
            font-weight: 500;
            color: var(--dark);
        }

        .user-dropdown {
            display: none;
            position: absolute;
            right: 0;
            top: calc(100% + 10px);
            background: white;
            min-width: 200px;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            overflow: hidden;
            animation: fadeIn 0.3s ease;
        }

        .user-info:hover .user-dropdown {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .user-dropdown a {
            display: block;
            padding: 12px 20px;
            color: var(--dark);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .user-dropdown a:hover {
            background: var(--lighter);
            border-left: 3px solid var(--primary);
            padding-left: 25px;
        }

        .user-dropdown a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* Content Section Styles with Glassmorphism */
        .content-section {
            flex: 1;
            padding: 30px;
            display: none;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: var(--glass-blur);
        }

        .content-section.active {
            display: block;
            animation: fadeInContent 0.5s ease;
        }

        @keyframes fadeInContent {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .content-section h2 {
            color: var(--dark);
            margin-bottom: 25px;
            font-weight: 600;
            position: relative;
            padding-bottom: 10px;
        }

        .content-section h2::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border-radius: 3px;
        }

        /* Card Styles with Glassmorphism */
        .card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            padding: 25px;
            margin-bottom: 25px;
            backdrop-filter: var(--glass-blur);
            border: var(--glass-border);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(39, 174, 96, 0.15);
        }

        .card h3 {
            color: var(--dark);
            margin-bottom: 15px;
            font-weight: 600;
        }

        /* Table Styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: var(--glass-blur);
            border-radius: 10px;
            overflow: hidden;
        }

        th,
        td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        th {
            background-color: rgba(39, 174, 96, 0.1);
            font-weight: 600;
            color: var(--dark);
        }

        tr:hover {
            background-color: rgba(39, 174, 96, 0.05);
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.2);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Button Styles */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            box-shadow: 0 6px 12px rgba(39, 174, 96, 0.2);
        }

        .btn-secondary {
            background-color: var(--gray);
            color: white;
        }

        .btn-success {
            background-color: var(--primary-light);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning);
            color: white;
        }

        /* Tambahkan ini ke dalam bagian CSS Anda */

        /* Style untuk card layanan */
        .service-card {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        /* Style untuk tombol aksi */
        .service-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .btn-detail {
            background-color: var(--lighter);
            color: var(--secondary);
            border: 1px solid var(--secondary);
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .btn-register {
            background-color: var(--warning);
            color: white;
        }

        .btn-register:hover {
            background-color: #e67e22;
        }

        /* Style khusus untuk tombol Buat */
        .btn-create {
            background-color: var(--danger);
            color: white;
        }

        .btn-create:hover {
            background-color: #c0392b;
        }

        .btn-action {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .btn-detail:hover {
            background-color: var(--secondary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.2);
        }

        .btn-action:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(39, 174, 96, 0.2);
        }

        /* Icon dalam tombol */
        .btn-detail i,
        .btn-action i {
            font-size: 0.9rem;
        }

        .btn-block {
            display: block;
            width: 100%;
        }

        /* Announcement Styles */
        .announcement {
            border-left: 4px solid var(--primary);
            padding: 20px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .announcement:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
        }

        .announcement h3 {
            margin-bottom: 8px;
            color: var(--dark);
            font-weight: 600;
        }

        .announcement-date {
            color: var(--gray);
            font-size: 0.85em;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Service Card Styles */
        .service-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 0;
            transition: all 0.3s ease;
            cursor: pointer;
            border: var(--glass-border);
            position: relative;
            overflow: hidden;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .service-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
        }

        .service-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(39, 174, 96, 0.15);
        }

        .service-card i {
            font-size: 2.5em;
            color: var(--primary);
            margin-bottom: 15px;
            background: rgba(39, 174, 96, 0.1);
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
        }

        .service-card h4 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--dark);
            font-weight: 600;
        }

        .service-card p {
            color: var(--gray);
            margin-bottom: 15px;
            flex-grow: 1;
        }

        .service-card .btn {
            align-self: flex-start;
            margin-top: auto;
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            border: var(--glass-border);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
        }

        .stat-card i {
            font-size: 2em;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .stat-card h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            color: var(--dark);
            font-weight: 700;
        }

        .stat-card p {
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* Utility Classes */
        .d-flex {
            display: flex;
        }

        .flex-column {
            flex-direction: column;
        }

        .justify-between {
            justify-content: space-between;
        }

        .justify-center {
            justify-content: center;
        }

        .align-center {
            align-items: center;
        }

        .gap-2 {
            gap: 10px;
        }

        .gap-3 {
            gap: 15px;
        }

        .gap-4 {
            gap: 20px;
        }

        .mb-2 {
            margin-bottom: 10px;
        }

        .mb-3 {
            margin-bottom: 15px;
        }

        .mb-4 {
            margin-bottom: 20px;
        }

        .mt-2 {
            margin-top: 10px;
        }

        .mt-3 {
            margin-top: 15px;
        }

        .mt-4 {
            margin-top: 20px;
        }

        .text-success {
            color: var(--primary);
        }

        .text-danger {
            color: var(--danger);
        }

        .text-warning {
            color: var(--warning);
        }

        .text-center {
            text-align: center;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-primary {
            background-color: rgba(39, 174, 96, 0.1);
            color: var(--primary);
        }

        .badge-secondary {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--secondary);
        }

        .badge-success {
            background-color: rgba(46, 204, 113, 0.1);
            color: var(--primary-light);
        }

        .badge-danger {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--danger);
        }

        .badge-warning {
            background-color: rgba(243, 156, 18, 0.1);
            color: var(--warning);
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                width: 80px;
                overflow: hidden;
            }

            .sidebar-header h2,
            .sidebar-menu li span {
                display: none;
            }

            .sidebar-menu li {
                justify-content: center;
                padding: 15px 0;
                margin: 5px;
            }

            .sidebar-menu li i {
                margin-right: 0;
                font-size: 1.3rem;
            }

            .sidebar-footer {
                width: 80px;
                padding: 15px 0;
                display: flex;
                justify-content: center;
            }

            .search-box {
                width: 200px;
            }
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                position: fixed;
                bottom: 0;
                z-index: 100;
                display: flex;
                border-top: var(--glass-border);
                border-right: none;
            }

            .sidebar-header {
                display: none;
            }

            .sidebar-menu ul {
                display: flex;
                width: 100%;
                justify-content: space-around;
            }

            .sidebar-menu li {
                flex-direction: column;
                padding: 10px 5px;
                font-size: 0.7rem;
                margin: 0;
                border-radius: 0;
            }

            .sidebar-menu li i {
                font-size: 1.2rem;
                margin-bottom: 5px;
            }

            .sidebar-menu li span {
                display: block;
                font-size: 0.7rem;
            }

            .sidebar-menu li.active::after {
                content: '';
                position: absolute;
                right: auto;
                top: 0;
                left: 0;
                width: 100%;
                height: 3px;
                background: var(--primary);
            }

            .sidebar-footer {
                display: none;
            }

            .main-content {
                margin-bottom: 70px;
            }

            .top-bar {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }

            .search-box {
                width: 100%;
            }

            .content-section {
                padding: 20px;
            }

            .grid {
                grid-template-columns: 1fr;
            }
        }

        /* Animation for cards */
        @keyframes cardEntrance {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card-animate {
            animation: cardEntrance 0.5s ease-out forwards;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(39, 174, 96, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        /* Floating action button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 5px 20px rgba(39, 174, 96, 0.4);
            cursor: pointer;
            z-index: 90;
            transition: all 0.3s ease;
        }

        .fab:hover {
            transform: scale(1.1) translateY(-5px);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.5);
        }

        /* Calendar widget */
        .calendar-widget {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .calendar-title {
            font-weight: 600;
            color: var(--dark);
        }

        .calendar-nav button {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--gray);
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-weight: 500;
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 10px;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .calendar-day:hover {
            background: rgba(39, 174, 96, 0.1);
        }

        .calendar-day.today {
            background: var(--primary);
            color: white;
            font-weight: 600;
        }

        .calendar-day.other-month {
            color: #ccc;
        }

        .calendar-day.event-day::after {
            content: '';
            position: absolute;
            bottom: 5px;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background: var(--primary);
        }

        /* Event widget */
        .event-widget {
            margin-top: 20px;
        }

        .event-item {
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .event-item:last-child {
            border-bottom: none;
        }

        .event-date {
            font-size: 0.8rem;
            color: var(--gray);
            margin-bottom: 5px;
        }

        .event-title {
            font-weight: 500;
            color: var(--dark);
        }

        /* Admin only elements */
        .admin-only {
            display: none;
        }

        .role-admin .admin-only {
            display: block;
        }

        .role-admin .admin-inline {
            display: inline-block;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <img src="LOGO_KABUPATEN_KEDIRI-removebg-preview.png" alt="Kecamatan Papar Logo" width="65" height="100">
                <h2>Kecamatan Papar</h2>
            </div>
            <div class="sidebar-menu">
                <ul>
                    <li class="active" data-section="dashboard">
                        <i class="fas fa-home"></i>
                        <span>Beranda</span>
                    </li>
                    <li data-section="announcements">
                        <i class="fas fa-bullhorn"></i>
                        <span>Pengumuman</span>
                    </li>
                    <li data-section="services">
                        <i class="fas fa-concierge-bell"></i>
                        <span>Layanan</span>
                    </li>
                    <li data-section="financial">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Keuangan</span>
                    </li>
                    <li data-section="programs">
                        <i class="fas fa-project-diagram"></i>
                        <span>Program</span>
                    </li>
                    <li data-section="complaints">
                        <i class="fas fa-comment-alt"></i>
                        <span>Pengaduan</span>
                    </li>
                    <li data-section="profile">
                        <i class="fas fa-user"></i>
                        <span>Profil</span>
                    </li>
                </ul>
            </div>
            <div class="sidebar-footer">
                <button id="logoutBtn" class="btn btn-danger btn-block">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Keluar</span>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="top-bar">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Cari pengumuman, layanan, atau informasi...">
                </div>
                <div class="user-info">
                    <img src="" alt="User" id="userProfileImage">
                    <span id="userDisplayName">Warga Desa</span>
                    <div class="user-dropdown">
                        <a href="#profile"><i class="fas fa-user"></i> Profil Saya</a>
                        <a href="#settings"><i class="fas fa-cog"></i> Pengaturan</a>
                        <a href="#help"><i class="fas fa-question-circle"></i> Bantuan</a>
                        <a href="#" id="logoutBtnDropdown"><i class="fas fa-sign-out-alt"></i> Keluar</a>
                    </div>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div class="content-section active" id="dashboardSection">
                <h2>Selamat Datang di Portal Digital Kecamatan Papar</h2>

                <div class="stats-grid">
                    <div class="stat-card card-animate" style="animation-delay: 0.1s;">
                        <i class="fas fa-users"></i>
                        <h3 id="totalResidents">0</h3>
                        <p>Warga Terdaftar</p>
                    </div>
                    <div class="stat-card card-animate" style="animation-delay: 0.2s;">
                        <i class="fas fa-home"></i>
                        <h3 id="totalHouseholds">0</h3>
                        <p>Kepala Keluarga</p>
                    </div>
                    <div class="stat-card card-animate" style="animation-delay: 0.3s;">
                        <i class="fas fa-hand-holding-usd"></i>
                        <h3 id="totalBudget">Rp 0</h3>
                        <p>Anggaran Kecamatan</p>
                    </div>
                    <div class="stat-card card-animate" style="animation-delay: 0.4s;">
                        <i class="fas fa-calendar-check"></i>
                        <h3 id="activePrograms">0</h3>
                        <p>Program Aktif</p>
                    </div>
                </div>

                <div class="d-flex flex-column gap-4" style="flex-direction: column-reverse;">
                    <div class="grid">
                        <div class="card card-animate" style="animation-delay: 0.2s;">
                            <h3>Pengumuman Terkini</h3>
                            <div id="latestAnnouncements">
                                <div class="spinner"></div>
                            </div>
                            <button class="btn btn-outline" id="viewAllAnnouncementsBtn">
                                <i class="fas fa-list"></i> Lihat Semua Pengumuman
                            </button>
                        </div>

                        <div class="card card-animate" style="animation-delay: 0.3s;">
                            <h3>Kalender Kegiatan</h3>
                            <div class="calendar-widget">
                                <div class="calendar-header">
                                    <div class="calendar-title" id="currentMonthYear">Juli 2023</div>
                                    <div class="calendar-nav">
                                        <button id="prevMonth"><i class="fas fa-chevron-left"></i></button>
                                        <button id="nextMonth"><i class="fas fa-chevron-right"></i></button>
                                    </div>
                                </div>
                                <div class="calendar-weekdays">
                                    <div>M</div>
                                    <div>S</div>
                                    <div>S</div>
                                    <div>R</div>
                                    <div>K</div>
                                    <div>J</div>
                                    <div>S</div>
                                </div>
                                <div class="calendar-days" id="calendarDays">
                                    <!-- Calendar days will be generated by JavaScript -->
                                </div>
                            </div>
                            <div class="event-widget">
                                <h4 class="mb-3">Kegiatan Hari Ini</h4>
                                <div id="todayEvents">
                                    <!-- Today's events will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card card-animate" style="animation-delay: 0.1s;">
                        <h3>Layanan Kecamatan</h3>
                        <div class="grid">
                            <div class="service-card" data-service="surat">
                                <i class="fas fa-id-card"></i>
                                <h4>Surat Keterangan</h4>
                                <p>Ajukan pembuatan berbagai surat keterangan dari Kecamatan</p>
                                <button class="btn btn-action"
                                    onclick="window.location.href='Surat keterangan.html'">Ajukan Sekarang</button>
                            </div>
                            <div class="service-card" data-service="kk">
                                <i class="fas fa-home"></i>
                                <h4>Kartu Keluarga</h4>
                                <p>Pengajuan dan perubahan data kartu keluarga</p>
                                <button class="btn btn-action" onclick="window.location.href='kartu.html'">Ajukan
                                    Sekarang</button>
                            </div>
                            <div class="service-card" data-service="bansos">
                                <i class="fas fa-hand-holding-usd"></i>
                                <h4>Bantuan Sosial</h4>
                                <p>Informasi dan pendaftaran bantuan sosial</p>
                                <button class="btn btn-action"
                                    onclick="window.location.href='bantuan sosial.html'">Lihat Informasi</button>
                            </div>
                            <div class="service-card" data-service="complaint">
                                <i class="fas fa-comments"></i>
                                <h4>Pengaduan</h4>
                                <p>Sampaikan pengaduan atau keluhan Anda</p>
                                <button class="btn btn-action"
                                    onclick="window.location.href='pengaduan warga.html'">Buat Pengaduan</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Announcements Section -->
            <div class="content-section" id="announcementsSection">
                <div class="d-flex justify-between align-center mb-4">
                    <h2>Pengumuman Kecamatan</h2>
                    <button class="btn btn-primary admin-only" id="addAnnouncementBtn">
                        <i class="fas fa-plus"></i> Tambah Pengumuman
                    </button>
                </div>

                <div class="card">
                    <div class="d-flex justify-between align-center mb-3">
                        <h3>Daftar Pengumuman</h3>
                        <div class="d-flex gap-2">
                            <select id="announcementFilter" class="form-group">
                                <option value="all">Semua Kategori</option>
                                <option value="general">Umum</option>
                                <option value="event">Kegiatan</option>
                                <option value="important">Penting</option>
                            </select>
                            <select id="announcementSort" class="form-group">
                                <option value="newest">Terbaru</option>
                                <option value="oldest">Terlama</option>
                            </select>
                        </div>
                    </div>

                    <div id="announcementsList">
                        <div class="spinner"></div>
                    </div>

                    <div class="d-flex justify-center mt-4">
                        <button class="btn btn-outline" id="loadMoreAnnouncements">
                            <i class="fas fa-arrow-down"></i> Muat Lebih Banyak
                        </button>
                    </div>
                </div>
            </div>

            <!-- Services Section -->
            <div class="content-section" id="servicesSection">
                <h2>Layanan Kecamatan</h2>
                <p class="mb-4">Pilih layanan yang Anda butuhkan untuk mengajukan permohonan secara online</p>

                <div class="grid">
                    <div class="card service-card" data-service="surat">
                        <i class="fas fa-id-card"></i>
                        <h3>Surat Keterangan</h3>
                        <p>Ajukan pembuatan berbagai surat keterangan dari Kecamatan seperti:</p>
                        <ul class="mb-3">
                            <li>Surat Keterangan Domisili</li>
                            <li>Surat Keterangan Tidak Mampu</li>
                            <li>Surat Keterangan Usaha</li>
                            <li>Surat Keterangan Kematian</li>
                            <li>Surat Keterangan Belum Menikah</li>
                        </ul>
                        <div class="d-flex justify-between mt-auto">
                            <button class="btn-detail">
                                <i class="fas fa-info-circle"></i> Detail
                            </button>
                            <button class="btn-action" onclick="window.location.href='Surat keterangan.html'">
                                <i class="fas fa-pen"></i> Ajukan
                            </button>
                        </div>
                    </div>

                    <div class="card service-card" data-service="kk">
                        <i class="fas fa-home"></i>
                        <h3>Kartu Keluarga</h3>
                        <p>Layanan terkait Kartu Keluarga:</p>
                        <ul class="mb-3">
                            <li>Pembuatan KK Baru</li>
                            <li>Perubahan Data KK</li>
                            <li>Pemisahan KK</li>
                            <li>Penggantian KK Hilang/Rusak</li>
                            <li>Penambahan Anggota Keluarga</li>
                        </ul>
                        <div class="d-flex justify-between mt-auto">
                            <button class="btn-detail">
                                <i class="fas fa-info-circle"></i> Detail
                            </button>
                            <button class="btn-action btn-create" onclick="window.location.href='kartu.html'">
                                <i class="fas fa-pen"></i> Buat
                            </button>
                        </div>
                    </div>

                    <div class="card service-card" data-service="bansos">
                        <i class="fas fa-hand-holding-usd"></i>
                        <h3>Bantuan Sosial</h3>
                        <p>Informasi dan pendaftaran bantuan sosial:</p>
                        <ul class="mb-3">
                            <li>PKH (Program Keluarga Harapan)</li>
                            <li>BLT (Bantuan Langsung Tunai)</li>
                            <li>BPNT (Bantuan Pangan Non Tunai)</li>
                            <li>Bantuan Pendidikan</li>
                            <li>Bantuan UMKM</li>
                        </ul>
                        <div class="d-flex justify-between mt-auto">
                            <button class="btn-detail">
                                <i class="fas fa-info-circle"></i> Detail
                            </button>
                            <button class="btn-action btn-register"
                                onclick="window.location.href='Bantuan sosial.html'">
                                <i class="fas fa-pen"></i> Daftar
                            </button>
                        </div>
                    </div>

                    <div class="card service-card" data-service="complaint">
                        <i class="fas fa-comments"></i>
                        <h3>Pengaduan Warga</h3>
                        <p>Sampaikan pengaduan atau keluhan Anda terkait:</p>
                        <ul class="mb-3">
                            <li>Pelayanan Publik</li>
                            <li>Infrastruktur Kecamatan</li>
                            <li>Masalah Sosial</li>
                            <li>Lingkungan</li>
                            <li>Lain-lain</li>
                        </ul>
                        <div class="d-flex justify-between mt-auto">
                            <button class="btn-detail">
                                <i class="fas fa-info-circle"></i> Detail
                            </button>
                            <button class="btn-action btn-create" onclick="window.location.href='Pengaduan warga.html'">
                                <i class="fas fa-pen"></i> Ajukan
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Financial Section -->
            <div class="content-section" id="financialSection">
                <h2>Transparansi Keuangan Kecamatan</h2>
                <p class="mb-4">Informasi keuangan Kecamatan yang dikelola secara transparan dan akuntabel</p>

                <div class="card">
                    <h3>Ringkasan Keuangan Kecamatan</h3>
                    <div class="grid">
                        <div class="stat-card">
                            <i class="fas fa-wallet"></i>
                            <h3 id="totalBudget">Rp 0</h3>
                            <p>Total Anggaran</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-money-bill-wave"></i>
                            <h3 id="totalExpense">Rp 0</h3>
                            <p>Realisasi</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-piggy-bank"></i>
                            <h3 id="remainingBudget">Rp 0</h3>
                            <p>Sisa Anggaran</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-percentage"></i>
                            <h3 id="realizationPercentage">0%</h3>
                            <p>Terealisasi</p>
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar" id="budgetProgress" style="width: 0%"></div>
                        <div class="progress-text" id="budgetProgressText">0% Terealisasi</div>
                    </div>
                </div>

                <div class="card">
                    <div class="d-flex justify-between align-center mb-3">
                        <h3>Daftar Transparansi Keuangan</h3>
                        <div class="d-flex gap-2">
                            <select id="financialYear" class="form-group">
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                                <option value="2021">2021</option>
                            </select>
                            <select id="financialFilter" class="form-group">
                                <option value="all">Semua</option>
                                <option value="income">Penerimaan</option>
                                <option value="expense">Pengeluaran</option>
                            </select>
                        </div>
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Uraian</th>
                                <th>Kategori</th>
                                <th>Jumlah</th>
                                <th>Sumber/Ditujukan</th>
                            </tr>
                        </thead>
                        <tbody id="financialTransactions">
                            <tr>
                                <td colspan="5" style="text-align: center;">
                                    <div class="spinner"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="d-flex justify-between mt-3">
                        <div>
                            <button class="btn btn-outline admin-only">
                                <i class="fas fa-download"></i> Unduh Laporan
                            </button>
                        </div>
                        <div>
                            <button class="btn btn-outline">
                                <i class="fas fa-print"></i> Cetak
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Programs Section -->
            <div class="content-section" id="programsSection">
                <h2>Program & Kegiatan Kecamatan</h2>
                <p class="mb-4">Informasi tentang berbagai program dan kegiatan yang dilaksanakan oleh Kecamatan Papar</p>
                </p>

                <div class="card">
                    <div class="d-flex justify-between align-center mb-3">
                        <h3>Daftar Program Kecamatan</h3>
                        <div class="d-flex gap-2">
                            <select id="programYear" class="form-group">
                                <option value="all">Semua Tahun</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                            </select>
                            <select id="programFilter" class="form-group">
                                <option value="all">Semua Status</option>
                                <option value="ongoing">Sedang Berjalan</option>
                                <option value="completed">Selesai</option>
                                <option value="planned">Akan Datang</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid" id="programsList">
                        <div class="spinner"></div>
                    </div>

                    <div class="d-flex justify-center mt-4">
                        <button class="btn btn-outline">
                            <i class="fas fa-plus"></i> Muat Lebih Banyak
                        </button>
                    </div>
                </div>
            </div>

            <!-- Complaints Section -->
            <div class="content-section" id="complaintsSection">
                <div class="d-flex justify-between align-center mb-4">
                    <h2>Pengaduan Warga</h2>
                    <button class="btn btn-primary" id="addComplaintBtn">
                        <i class="fas fa-plus"></i> Buat Pengaduan
                    </button>
                </div>

                <div class="card" id="complaintForm" style="display: none;">
                    <h3>Form Pengaduan</h3>
                    <form id="complaintFormData">
                        <div class="form-group">
                            <label for="complaintType">Jenis Pengaduan</label>
                            <select id="complaintType" required>
                                <option value="">Pilih Jenis Pengaduan</option>
                                <option value="infrastructure">Infrastruktur</option>
                                <option value="service">Pelayanan</option>
                                <option value="social">Sosial</option>
                                <option value="environment">Lingkungan</option>
                                <option value="other">Lainnya</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="complaintTitle">Judul Pengaduan</label>
                            <input type="text" id="complaintTitle" placeholder="Masukkan judul pengaduan" required>
                        </div>
                        <div class="form-group">
                            <label for="complaintDescription">Deskripsi Pengaduan</label>
                            <textarea id="complaintDescription"
                                placeholder="Jelaskan pengaduan Anda secara detail (lengkapi dengan waktu, lokasi, dan kronologi kejadian)"
                                required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="complaintProof">Bukti Pendukung (Foto/Dokumen)</label>
                            <div
                                style="border: 2px dashed #ddd; border-radius: 8px; padding: 20px; text-align: center;">
                                <i class="fas fa-cloud-upload-alt"
                                    style="font-size: 2rem; color: var(--gray); margin-bottom: 10px;"></i>
                                <p style="color: var(--gray);">Seret file ke sini atau klik untuk memilih</p>
                                <input type="file" id="complaintProof" style="display: none;">
                                <button type="button" class="btn btn-outline"
                                    onclick="document.getElementById('complaintProof').click()">
                                    <i class="fas fa-folder-open"></i> Pilih File
                                </button>
                            </div>
                            <small style="color: var(--gray);">Format file: JPG, PNG, PDF (maks. 5MB)</small>
                        </div>
                        <div class="d-flex justify-between mt-4">
                            <button type="button" class="btn btn-secondary" id="cancelComplaintBtn">
                                <i class="fas fa-times"></i> Batal
                            </button>
                            <button type="submit" class="btn btn-primary" id="submitComplaintBtn">
                                <i class="fas fa-paper-plane"></i> Kirim Pengaduan
                            </button>
                        </div>
                    </form>
                </div>

                <div class="card">
                    <h3>Daftar Pengaduan Saya</h3>
                    <div class="d-flex justify-between align-center mb-3">
                        <div>
                            <select id="complaintStatusFilter" class="form-group">
                                <option value="all">Semua Status</option>
                                <option value="pending">Diproses</option>
                                <option value="processed">Ditindaklanjuti</option>
                                <option value="completed">Selesai</option>
                                <option value="rejected">Ditolak</option>
                            </select>
                        </div>
                        <div>
                            <button class="btn btn-outline">
                                <i class="fas fa-filter"></i> Filter
                            </button>
                        </div>
                    </div>

                    <table id="complaintsTable">
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Judul</th>
                                <th>Jenis</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="userComplaintsList">
                            <tr>
                                <td colspan="5" style="text-align: center;">
                                    <div class="spinner"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="d-flex justify-center mt-3">
                        <button class="btn btn-outline">
                            <i class="fas fa-history"></i> Lihat Riwayat
                        </button>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div class="content-section" id="profileSection">
                <h2>Profil Saya</h2>
                <p class="mb-4">Kelola informasi profil dan akun Anda</p>

                <div class="card">
                    <div class="d-flex" style="gap: 30px; flex-wrap: wrap;">
                        <div style="flex: 0 0 250px;">
                            <div
                                style="width: 180px; height: 180px; border-radius: 50%; background-color: #eee; margin: 0 auto 20px; overflow: hidden; border: 5px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                                <img id="profilePhoto" src="https://via.placeholder.com/180" alt="Profile Photo"
                                    style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                            <button class="btn btn-outline btn-block mb-3" id="changePhotoBtn">
                                <i class="fas fa-camera"></i> Ubah Foto
                            </button>
                            <div class="card" style="padding: 15px; text-align: center;">
                                <h4 style="margin-bottom: 5px;">Status Verifikasi</h4>
                                <div class="badge badge-success">
                                    <i class="fas fa-check-circle"></i> Terverifikasi
                                </div>
                            </div>
                        </div>

                        <div style="flex: 1; min-width: 300px;">
                            <form id="profileForm">
                                <div class="grid"
                                    style="grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-bottom: 15px;">
                                    <div class="form-group">
                                        <label for="profileName">Nama Lengkap</label>
                                        <input type="text" id="profileName" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="profileNIK">NIK</label>
                                        <input type="text" id="profileNIK" readonly>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="profileAddress">Alamat Lengkap</label>
                                    <textarea id="profileAddress" required></textarea>
                                </div>

                                <div class="grid"
                                    style="grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-bottom: 15px;">
                                    <div class="form-group">
                                        <label for="profilePhone">No. HP</label>
                                        <input type="tel" id="profilePhone">
                                    </div>
                                    <div class="form-group">
                                        <label for="profileEmail">Email</label>
                                        <input type="email" id="profileEmail">
                                    </div>
                                </div>

                                <div class="grid"
                                    style="grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">
                                    <div class="form-group">
                                        <label for="profileRT">RT</label>
                                        <input type="text" id="profileRT">
                                    </div>
                                    <div class="form-group">
                                        <label for="profileRW">RW</label>
                                        <input type="text" id="profileRW">
                                    </div>
                                </div>

                                <div class="d-flex justify-between mt-4">
                                    <button type="button" class="btn btn-secondary" id="cancelProfileBtn">
                                        <i class="fas fa-times"></i> Batal
                                    </button>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Simpan Perubahan
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="card mt-4">
                    <h3>Ubah Password</h3>
                    <form id="passwordForm">
                        <div class="grid"
                            style="grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-bottom: 15px;">
                            <div class="form-group">
                                <label for="currentPassword">Password Saat Ini</label>
                                <input type="password" id="currentPassword" required>
                            </div>
                            <div class="form-group">
                                <label for="newPassword">Password Baru</label>
                                <input type="password" id="newPassword" required>
                            </div>
                            <div class="form-group">
                                <label for="confirmNewPassword">Konfirmasi Password Baru</label>
                                <input type="password" id="confirmNewPassword" required>
                            </div>
                        </div>
                        <div class="d-flex justify-end mt-3">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-key"></i> Ubah Password
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <div class="fab" id="helpFab">
        <i class="fas fa-question"></i>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-storage-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAEyyQvtGV9UtFFASxhKFhtUu5WaCY-7YM",
            authDomain: "web-menajemen-keuangan.firebaseapp.com",
            databaseURL: "https://web-menajemen-keuangan-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "web-menajemen-keuangan",
            storageBucket: "web-menajemen-keuangan.appspot.com",
            messagingSenderId: "701529272865",
            appId: "1:701529272865:web:3acaab7a2931905f152960",
            measurementId: "G-G226XMT0TC"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const firestore = firebase.firestore();
        const storage = firebase.storage();

        // Current user data
        let currentUser = null;
        let userProfile = null;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        // DOM Elements
        const sections = {
            dashboard: document.getElementById('dashboardSection'),
            announcements: document.getElementById('announcementsSection'),
            services: document.getElementById('servicesSection'),
            financial: document.getElementById('financialSection'),
            programs: document.getElementById('programsSection'),
            complaints: document.getElementById('complaintsSection'),
            profile: document.getElementById('profileSection')
        };

        const sidebarLinks = document.querySelectorAll('.sidebar-menu li');
        const logoutBtn = document.getElementById('logoutBtn');
        const logoutBtnDropdown = document.getElementById('logoutBtnDropdown');
        const userDisplayName = document.getElementById('userDisplayName');
        const userProfileImage = document.getElementById('userProfileImage');
        const profileName = document.getElementById('profileName');
        const profileNIK = document.getElementById('profileNIK');
        const profileAddress = document.getElementById('profileAddress');
        const profilePhone = document.getElementById('profilePhone');
        const profileEmail = document.getElementById('profileEmail');
        const profilePhoto = document.getElementById('profilePhoto');
        const changePhotoBtn = document.getElementById('changePhotoBtn');
        const cancelProfileBtn = document.getElementById('cancelProfileBtn');
        const profileForm = document.getElementById('profileForm');
        const passwordForm = document.getElementById('passwordForm');
        const viewAllAnnouncementsBtn = document.getElementById('viewAllAnnouncementsBtn');
        const addComplaintBtn = document.getElementById('addComplaintBtn');
        const cancelComplaintBtn = document.getElementById('cancelComplaintBtn');
        const complaintForm = document.getElementById('complaintForm');
        const complaintFormData = document.getElementById('complaintFormData');
        const submitComplaintBtn = document.getElementById('submitComplaintBtn');
        const helpFab = document.getElementById('helpFab');
        const prevMonthBtn = document.getElementById('prevMonth');
        const nextMonthBtn = document.getElementById('nextMonth');
        const calendarDays = document.getElementById('calendarDays');
        const currentMonthYear = document.getElementById('currentMonthYear');
        const todayEvents = document.getElementById('todayEvents');

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function () {
            initAuthState();
            initUIEvents();
            generateCalendar(currentMonth, currentYear);
            loadTodayEvents();
        });

        // Generate calendar
        function generateCalendar(month, year) {
            calendarDays.innerHTML = '';

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1; // Adjust for Monday start

            // Set month and year title
            const monthNames = ["Januari", "Februari", "Maret", "April", "Mei", "Juni",
                "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
            currentMonthYear.textContent = `${monthNames[month]} ${year}`;

            // Previous month days
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            for (let i = 0; i < startingDay; i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day other-month';
                day.textContent = prevMonthLastDay - startingDay + i + 1;
                calendarDays.appendChild(day);
            }

            // Current month days
            const today = new Date();
            for (let i = 1; i <= daysInMonth; i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day';
                day.textContent = i;

                // Highlight today
                if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    day.classList.add('today');
                }

                // Add event marker (example)
                if (i % 5 === 0) {
                    day.classList.add('event-day');
                }

                calendarDays.appendChild(day);
            }

            // Next month days
            const daysToShow = 42 - (startingDay + daysInMonth); // 6 rows x 7 days
            for (let i = 1; i <= daysToShow; i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day other-month';
                day.textContent = i;
                calendarDays.appendChild(day);
            }
        }

        // Load today's events
        function loadTodayEvents() {
            // In a real app, this would fetch from database
            const today = new Date();
            const events = [
                {
                    time: "09:00 - 12:00",
                    title: "Posyandu Balita"
                },
                {
                    time: "14:00 - 16:00",
                    title: "Rapat RT 05"
                }
            ];

            todayEvents.innerHTML = '';

            if (events.length === 0) {
                todayEvents.innerHTML = '<p>Tidak ada kegiatan hari ini</p>';
                return;
            }

            events.forEach(event => {
                const eventItem = document.createElement('div');
                eventItem.className = 'event-item';
                eventItem.innerHTML = `
                    <div class="event-date"><i class="far fa-clock"></i> ${event.time}</div>
                    <div class="event-title">${event.title}</div>
                `;
                todayEvents.appendChild(eventItem);
            });
        }

        function loadDashboardStats() {
            // Update resident count
            firestore.collection('residents').onSnapshot(snapshot => {
                document.getElementById('totalResidents').textContent = snapshot.size;
            });

            // Update family count
            firestore.collection('families').onSnapshot(snapshot => {
                document.getElementById('totalHouseholds').textContent = snapshot.size;
            });

            // Update budget
            database.ref('budget').on('value', snapshot => {
                const budgetData = snapshot.val();
                const totalBudget = budgetData?.total || 0;
                document.getElementById('totalBudget').textContent = 'Rp ' + new Intl.NumberFormat('id-ID').format(totalBudget);
            });

            // Load active programs count (real-time)
            const now = new Date();
            firestore.collection('programs')
                .where('startDate', '<=', now)
                .where('endDate', '>=', now)
                .onSnapshot(snapshot => {
                    document.getElementById('activePrograms').textContent = snapshot.size;
                }, error => {
                    console.error("Error loading active programs:", error);
                    document.getElementById('activePrograms').textContent = "0";
                });
        }

        // Update financial summary from database
        function updateFinancialSummary() {
            const financialRef = database.ref('budget');

            financialRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    const totalBudget = data.total || 0;
                    const totalExpense = data.expense || 0;
                    const remainingBudget = totalBudget - totalExpense;
                    const realizationPercentage = totalBudget > 0 ? Math.round((totalExpense / totalBudget) * 100) : 0;

                    document.getElementById('totalBudget').textContent = formatCurrency(totalBudget);
                    document.getElementById('totalExpense').textContent = formatCurrency(totalExpense);
                    document.getElementById('remainingBudget').textContent = formatCurrency(remainingBudget);
                    document.getElementById('realizationPercentage').textContent = `${realizationPercentage}%`;
                    document.getElementById('budgetProgress').style.width = `${realizationPercentage}%`;
                    document.getElementById('budgetProgressText').textContent = `${realizationPercentage}% terealisasi`;
                }
            });
        }

        // Initialize authentication state listener
        function initAuthState() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    // User is signed in
                    currentUser = user;
                    loadUserProfile(user.uid);
                    updateUIForUser(user);

                    // Panggil fungsi updateFinancialSummary
                    updateFinancialSummary();

                    // Update stats that come from database
                    loadDashboardStats();
                    loadInitialData();
                } else {
                    // User is signed out
                    window.location.href = 'index.html';
                }
            });
        }

        // Load user profile from Firestore
        function loadUserProfile(userId) {
            firestore.collection('users').doc(userId).get()
                .then(doc => {
                    if (doc.exists) {
                        userProfile = doc.data();
                        updateProfileUI(userProfile);
                        loadInitialData();

                        // Add role class to body if admin
                        if (userProfile.role === 'admin') {
                            document.body.classList.add('role-admin');
                        }
                    } else {
                        console.log("No user profile found");
                        // Create a basic profile if not exists
                        createUserProfile(userId);
                    }
                })
                .catch(error => {
                    console.error("Error loading user profile:", error);
                });
        }

        // Create a basic user profile if not exists
        function createUserProfile(userId) {
            const userRef = firestore.collection('users').doc(userId);
            const basicProfile = {
                name: currentUser.displayName || 'Warga Desa',
                email: currentUser.email,
                nik: '',
                address: '',
                phone: '',
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                role: 'resident'
            };

            userRef.set(basicProfile)
                .then(() => {
                    userProfile = basicProfile;
                    updateProfileUI(basicProfile);
                    loadInitialData();
                })
                .catch(error => {
                    console.error("Error creating user profile:", error);
                });
        }

        // Update UI based on user authentication state
        function updateUIForUser(user) {
            userDisplayName.textContent = user.displayName || 'Warga Desa';
            if (user.photoURL) {
                userProfileImage.src = user.photoURL;
                profilePhoto.src = user.photoURL;
            }
        }

        // Update profile section UI
        function updateProfileUI(profile) {
            profileName.value = profile.name || '';
            profileNIK.value = profile.nik || '';
            profileAddress.value = profile.address || '';
            profilePhone.value = profile.phone || '';
            profileEmail.value = profile.email || '';
            userDisplayName.textContent = profile.name || 'Warga Desa';
        }

        // Load initial data for the dashboard
        function loadInitialData() {
            loadLatestAnnouncements();
            loadFinancialTransactions();
            loadVillagePrograms();
            loadUserComplaints();
        }

        // Load latest announcements (3 most recent)
        function loadLatestAnnouncements() {
            const announcementsRef = firestore.collection('announcements')
                .orderBy('createdAt', 'desc')
                .limit(3);

            announcementsRef.get()
                .then(querySnapshot => {
                    const announcementsContainer = document.getElementById('latestAnnouncements');
                    announcementsContainer.innerHTML = '';

                    if (querySnapshot.empty) {
                        announcementsContainer.innerHTML = '<p>Tidak ada pengumuman terbaru</p>';
                        return;
                    }

                    querySnapshot.forEach(doc => {
                        const announcement = doc.data();
                        announcementsContainer.appendChild(createAnnouncementElement(announcement));
                    })
                })
                .catch(error => {
                    console.error("Error loading announcements:", error);
                    document.getElementById('latestAnnouncements').innerHTML =
                        '<p class="text-danger">Gagal memuat pengumuman</p>';
                });
        }

        // Load all announcements with filtering
        function loadAllAnnouncements(filter = 'all') {
            const announcementsContainer = document.getElementById('announcementsList');
            announcementsContainer.innerHTML = '<div class="spinner"></div>';

            let query = firestore.collection('announcements').orderBy('createdAt', 'desc');

            if (filter !== 'all') {
                query = query.where('category', '==', filter);
            }

            query.get()
                .then(querySnapshot => {
                    announcementsContainer.innerHTML = '';

                    if (querySnapshot.empty) {
                        announcementsContainer.innerHTML = '<p>Tidak ada pengumuman</p>';
                        return;
                    }

                    querySnapshot.forEach(doc => {
                        const announcement = doc.data();
                        announcementsContainer.appendChild(createAnnouncementElement(announcement));
                    });
                })
                .catch(error => {
                    console.error("Error loading announcements:", error);
                    announcementsContainer.innerHTML =
                        '<p class="text-danger">Gagal memuat pengumuman</p>';
                });
        }

        // Create announcement HTML element
        function createAnnouncementElement(announcement) {
            const announcementDiv = document.createElement('div');
            announcementDiv.className = 'announcement';

            // Format date
            const date = announcement.createdAt?.toDate() || new Date();
            const formattedDate = date.toLocaleDateString('id-ID', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });

            // Get category badge
            let badgeClass = 'badge-secondary';
            let categoryText = 'Umum';

            if (announcement.category === 'event') {
                badgeClass = 'badge-primary';
                categoryText = 'Kegiatan';
            } else if (announcement.category === 'important') {
                badgeClass = 'badge-danger';
                categoryText = 'Penting';
            }

            announcementDiv.innerHTML = `
                <h3>${announcement.title}</h3>
                <p class="announcement-date"><i class="far fa-calendar-alt"></i> ${formattedDate}</p>
                <p>${announcement.content}</p>
                <p><strong>Kategori:</strong> <span class="badge ${badgeClass}">${categoryText}</span></p>
            `;

            return announcementDiv;
        }

        // Load financial transactions with filtering
        function loadFinancialTransactions(filter = 'all') {
            const transactionsContainer = document.getElementById('financialTransactions');
            transactionsContainer.innerHTML = '<tr><td colspan="5" style="text-align: center;"><div class="spinner"></div></td></tr>';

            let query = database.ref('transactions').orderByChild('date');

            query.once('value')
                .then(snapshot => {
                    transactionsContainer.innerHTML = '';

                    if (!snapshot.exists()) {
                        transactionsContainer.innerHTML = '<tr><td colspan="5">Tidak ada transaksi</td></tr>';
                        return;
                    }

                    const transactions = [];
                    snapshot.forEach(childSnapshot => {
                        const transaction = childSnapshot.val();
                        transaction.id = childSnapshot.key;
                        transactions.push(transaction);
                    });

                    // Sort by date (newest first)
                    transactions.sort((a, b) => new Date(b.date) - new Date(a.date));

                    // Apply filter
                    const filteredTransactions = filter === 'all'
                        ? transactions
                        : transactions.filter(t => t.type === filter);

                    if (filteredTransactions.length === 0) {
                        transactionsContainer.innerHTML = '<tr><td colspan="5">Tidak ada transaksi</td></tr>';
                        return;
                    }

                    filteredTransactions.forEach(transaction => {
                        const row = document.createElement('tr');

                        // Format date
                        const date = new Date(transaction.date);
                        const formattedDate = date.toLocaleDateString('id-ID');

                        // Format amount with color based on type
                        const amountClass = transaction.type === 'income' ? 'text-success' : 'text-danger';
                        const amountPrefix = transaction.type === 'income' ? '+' : '-';

                        row.innerHTML = `
                            <td>${formattedDate}</td>
                            <td>${transaction.description}</td>
                            <td>${transaction.category || '-'}</td>
                            <td class="${amountClass}">${amountPrefix}${formatCurrency(transaction.amount)}</td>
                            <td>${transaction.source || '-'}</td>
                        `;

                        transactionsContainer.appendChild(row);
                    });
                })
                .catch(error => {
                    console.error("Error loading transactions:", error);
                    transactionsContainer.innerHTML = '<tr><td colspan="5" class="text-danger">Gagal memuat data transaksi</td></tr>';
                });
        }

        // Load village programs with filtering
        function loadVillagePrograms(filter = 'all') {
            const programsContainer = document.getElementById('programsList');
            programsContainer.innerHTML = '<div class="spinner"></div>';

            let query = firestore.collection('programs').orderBy('startDate', 'desc');

            if (filter !== 'all') {
                const now = new Date();

                if (filter === 'ongoing') {
                    query = query.where('startDate', '<=', now)
                        .where('endDate', '>=', now);
                } else if (filter === 'completed') {
                    query = query.where('endDate', '<', now);
                } else if (filter === 'planned') {
                    query = query.where('startDate', '>', now);
                }
            }

            query.get()
                .then(querySnapshot => {
                    programsContainer.innerHTML = '';

                    if (querySnapshot.empty) {
                        programsContainer.innerHTML = '<p>Tidak ada program desa</p>';
                        return;
                    }

                    querySnapshot.forEach(doc => {
                        const program = doc.data();
                        programsContainer.appendChild(createProgramCard(program));
                    });
                })
                .catch(error => {
                    console.error("Error loading programs:", error);
                    programsContainer.innerHTML = '<p class="text-danger">Gagal memuat program desa</p>';
                });
        }

        // Create program card HTML element
        function createProgramCard(program) {
            const programDiv = document.createElement('div');
            programDiv.className = 'card program-card';

            // Format dates
            const startDate = program.startDate?.toDate() || new Date();
            const endDate = program.endDate?.toDate() || new Date();

            const formattedStartDate = startDate.toLocaleDateString('id-ID');
            const formattedEndDate = endDate.toLocaleDateString('id-ID');

            // Determine status
            const now = new Date();
            let status = 'planned';
            let statusClass = 'badge-secondary';
            let statusText = 'Akan Datang';

            if (startDate <= now && endDate >= now) {
                status = 'ongoing';
                statusClass = 'badge-primary';
                statusText = 'Sedang Berjalan';
            } else if (endDate < now) {
                status = 'completed';
                statusClass = 'badge-success';
                statusText = 'Selesai';
            }

            programDiv.innerHTML = `
                <div class="badge badge-primary mb-2">${program.category || 'Umum'}</div>
                <h3>${program.title}</h3>
                <p class="mb-2"><strong>Anggaran:</strong> ${formatCurrency(program.budget)}</p>
                <p class="mb-3"><strong>Periode:</strong> ${formattedStartDate} - ${formattedEndDate}</p>
                <p class="mb-3">${program.description}</p>
                <div class="d-flex justify-between align-center">
                    <div class="badge ${statusClass}">${statusText}</div>
                    <button class="btn btn-outline btn-sm">Detail</button>
                </div>
            `;

            return programDiv;
        }

        function loadUserComplaints(statusFilter = 'all') {
            if (!currentUser) {
                console.error("No authenticated user");
                return;
            }

            const complaintsContainer = document.getElementById('userComplaintsList');
            complaintsContainer.innerHTML = `
        <tr>
            <td colspan="5" style="text-align: center;">
                <div class="spinner"></div>
                <p class="text-muted mt-2">Memuat pengaduan Anda...</p>
            </td>
        </tr>
    `;

            let query = firestore.collection('complaints')
                .orderBy('createdAt', 'desc');

            if (statusFilter !== 'all') {
                query = query.where('status', '==', statusFilter);
            }

            query.get()
                .then(querySnapshot => {
                    complaintsContainer.innerHTML = '';

                    if (querySnapshot.empty) {
                        complaintsContainer.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 30px;">
                            <i class="fas fa-inbox" style="font-size: 2rem; color: var(--gray); margin-bottom: 10px;"></i>
                            <p>Tidak ada pengaduan dengan status ${statusFilter === 'all' ? '' : statusFilter}</p>
                            <button class="btn btn-primary mt-2" onclick="document.getElementById('addComplaintBtn').click()">
                                <i class="fas fa-plus"></i> Buat Pengaduan Baru
                            </button>
                        </td>
                    </tr>
                `;
                        return;
                    }

                    querySnapshot.forEach(doc => {
                        const complaint = { id: doc.id, ...doc.data() }; // Gabungkan ID dengan data
                        complaintsContainer.appendChild(createComplaintRow(complaint));
                    });

                    // Update counter jika diperlukan
                    if (document.getElementById('userComplaintCount')) {
                        document.getElementById('userComplaintCount').textContent = querySnapshot.size;
                    }
                })
                .catch(error => {
                    console.error("Error loading complaints:", error);
                    complaintsContainer.innerHTML = `
                <tr>
                    <td colspan="5" style="text-align: center; padding: 30px;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; color: var(--danger); margin-bottom: 10px;"></i>
                        <p class="text-danger">Gagal memuat daftar pengaduan</p>
                        <p class="text-muted small">${error.message || 'Coba lagi nanti'}</p>
                        <button class="btn btn-outline-danger mt-2" onclick="loadUserComplaints('${statusFilter}')">
                            <i class="fas fa-sync-alt"></i> Muat Ulang
                        </button>
                    </td>
                </tr>
            `;
                });
        }

        function createComplaintRow(complaint) {
            const row = document.createElement('tr');

            // Format date
            const date = complaint.createdAt?.toDate() || new Date();
            const formattedDate = date.toLocaleDateString('id-ID', {
                day: 'numeric',
                month: 'short',
                year: 'numeric'
            });

            // Determine status and badge class
            let statusClass, statusText;
            switch (complaint.status) {
                case 'processed':
                    statusClass = 'badge-warning';
                    statusText = 'Ditindaklanjuti';
                    break;
                case 'completed':
                    statusClass = 'badge-success';
                    statusText = 'Selesai';
                    break;
                case 'rejected':
                    statusClass = 'badge-danger';
                    statusText = 'Ditolak';
                    break;
                default: // pending
                    statusClass = 'badge-primary';
                    statusText = 'Diproses';
            }

            row.innerHTML = `
        <td>${formattedDate}</td>
        <td>${complaint.title || 'Tidak ada judul'}</td>
        <td>${getComplaintTypeText(complaint.type)}</td>
        <td><span class="badge ${statusClass}">${statusText}</span></td>
        <td>
            <button class="btn btn-outline btn-sm" onclick="viewComplaintDetail('${complaint.id}')">
                <i class="fas fa-eye"></i> Detail
            </button>
        </td>
    `;

            return row;
        }

        function getComplaintTypeText(type) {
            const types = {
                'infrastructure': 'Infrastruktur',
                'service': 'Pelayanan',
                'social': 'Sosial',
                'environment': 'Lingkungan',
                'other': 'Lainnya'
            };

            return types[type] || type;
        }

        function viewComplaintDetail(complaintId) {
            firestore.collection('complaints').doc(complaintId).get()
                .then(doc => {
                    if (doc.exists) {
                        const complaint = doc.data();

                        // Buat elemen modal
                        const modal = document.createElement('div');
                        modal.className = 'complaint-modal';
                        modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.5);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 1000;
                `;

                        // Buat konten modal
                        modal.innerHTML = `
                    <div class="modal-content" style="
                        background: white;
                        border-radius: 12px;
                        width: 90%;
                        max-width: 800px;
                        max-height: 90vh;
                        overflow-y: auto;
                        padding: 25px;
                        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
                    ">
                        <div class="modal-header" style="
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 20px;
                            padding-bottom: 15px;
                            border-bottom: 1px solid rgba(0,0,0,0.1);
                        ">
                            <h3 style="font-size: 1.5rem; color: #2c3e50;">Detail Pengaduan</h3>
                            <button class="modal-close" style="
                                background: none;
                                border: none;
                                font-size: 1.5rem;
                                cursor: pointer;
                                color: #95a5a6;
                            ">&times;</button>
                        </div>
                        <div class="card" style="
                            background: rgba(255,255,255,0.8);
                            border-radius: 12px;
                            box-shadow: 0 8px 32px 0 rgba(31,38,135,0.1);
                            padding: 25px;
                            margin-bottom: 25px;
                            backdrop-filter: blur(12px);
                            border: 1px solid rgba(255,255,255,0.2);
                        ">
                            <h3>${complaint.title || 'Tidak ada judul'}</h3>
                            <p><strong>Tanggal:</strong> ${complaint.createdAt?.toDate().toLocaleDateString('id-ID') || '-'}</p>
                            <p><strong>Jenis:</strong> ${getComplaintTypeText(complaint.type)}</p>
                            <p><strong>Status:</strong> <span class="badge ${getStatusBadgeClass(complaint.status)}">${getStatusText(complaint.status)}</span></p>
                            <div class="form-group" style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #2c3e50;">Deskripsi</label>
                                <div style="padding: 10px; background: #f5f5f5; border-radius: 5px;">
                                    ${complaint.description || 'Tidak ada deskripsi'}
                                </div>
                            </div>
                            ${complaint.proofUrl ? `
                            <div class="form-group" style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #2c3e50;">Bukti</label>
                                <img src="${complaint.proofUrl}" style="max-width: 100%; border-radius: 5px;">
                            </div>
                            ` : ''}
                            ${complaint.response ? `
                            <div class="form-group" style="margin-bottom: 20px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #2c3e50;">Tanggapan</label>
                                <div style="padding: 10px; background: #f5f5f5; border-radius: 5px;">
                                    ${complaint.response}
                                </div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;

                        // Tambahkan modal ke body
                        document.body.appendChild(modal);

                        // Tambahkan event listener untuk tombol close
                        const closeButton = modal.querySelector('.modal-close');
                        closeButton.addEventListener('click', () => {
                            document.body.removeChild(modal);
                        });

                        // Tutup modal ketika klik di luar konten
                        modal.addEventListener('click', (e) => {
                            if (e.target === modal) {
                                document.body.removeChild(modal);
                            }
                        });
                    }
                })
                .catch(error => {
                    console.error("Error loading complaint details:", error);
                    alert('Gagal memuat detail pengaduan');
                });
        }
        function getStatusText(status) {
            switch (status) {
                case 'pending': return 'Diproses';
                case 'processed': return 'Ditindaklanjuti';
                case 'completed': return 'Selesai';
                case 'rejected': return 'Ditolak';
                default: return status;
            }
        }

        function getStatusBadgeClass(status) {
            switch (status) {
                case 'pending': return 'badge-primary';
                case 'processed': return 'badge-warning';
                case 'completed': return 'badge-success';
                case 'rejected': return 'badge-danger';
                default: return 'badge-secondary';
            }
        }

        // Fungsi untuk memformat mata uang
        function formatCurrency(amount) {
            if (isNaN(amount)) amount = 0;
            return 'Rp ' + new Intl.NumberFormat('id-ID').format(amount);
        }

        // Initialize UI event listeners
        function initUIEvents() {

            document.getElementById('complaintStatusFilter').addEventListener('change', (e) => {
                loadUserComplaints(e.target.value);
            });

            // Calendar navigation
            prevMonthBtn.addEventListener('click', () => {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                generateCalendar(currentMonth, currentYear);
            });

            nextMonthBtn.addEventListener('click', () => {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                generateCalendar(currentMonth, currentYear);
            });

            // Section switching
            sidebarLinks.forEach(link => {
                link.addEventListener('click', () => {
                    const section = link.getAttribute('data-section');

                    // Update active state
                    sidebarLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');

                    // Show selected section
                    Object.values(sections).forEach(sec => sec.classList.remove('active'));
                    if (sections[section]) {
                        sections[section].classList.add('active');

                        // Load section-specific data
                        switch (section) {
                            case 'residents':
                                loadResidents();
                                break;
                            case 'families':
                                loadFamilies();
                                break;
                            case 'announcements':
                                loadAllAnnouncements();
                                break;
                            case 'financial':
                                loadFinancialTransactions();
                                break;
                            case 'programs':
                                loadPrograms();
                                break;
                        }
                    }
                });
            });

            // Logout button
            logoutBtn.addEventListener('click', handleLogout);
            logoutBtnDropdown.addEventListener('click', handleLogout);

            function handleLogout(e) {
                e.preventDefault();
                if (confirm('Apakah Anda yakin ingin keluar?')) {
                    auth.signOut().then(() => {
                        window.location.href = 'index.html';
                    }).catch(error => {
                        console.error("Logout error:", error);
                        alert('Gagal keluar. Silakan coba lagi.');
                    });
                }
            }

            // View all announcements button
            viewAllAnnouncementsBtn.addEventListener('click', () => {
                sidebarLinks.forEach(l => l.classList.remove('active'));
                document.querySelector('.sidebar-menu li[data-section="announcements"]').classList.add('active');

                Object.values(sections).forEach(sec => sec.classList.remove('active'));
                sections.announcements.classList.add('active');

                loadAllAnnouncements();
            });

            // Announcement filter
            document.getElementById('announcementFilter').addEventListener('change', (e) => {
                loadAllAnnouncements(e.target.value);
            });

            // Financial filter
            document.getElementById('financialFilter').addEventListener('change', (e) => {
                loadFinancialTransactions(e.target.value);
            });

            // Program filter
            document.getElementById('programFilter').addEventListener('change', (e) => {
                loadVillagePrograms(e.target.value);
            });

            // Complaint form handling
            addComplaintBtn.addEventListener('click', () => {
                complaintForm.style.display = 'block';
                window.scrollTo({
                    top: complaintForm.offsetTop - 20,
                    behavior: 'smooth'
                });
            });

            cancelComplaintBtn.addEventListener('click', () => {
                complaintForm.style.display = 'none';
                complaintFormData.reset();
            });

            // Submit complaint
            complaintFormData.addEventListener('submit', async (e) => {
                e.preventDefault();

                if (!currentUser) return;

                const type = document.getElementById('complaintType').value;
                const title = document.getElementById('complaintTitle').value;
                const description = document.getElementById('complaintDescription').value;
                const proofFile = document.getElementById('complaintProof').files[0];

                submitComplaintBtn.disabled = true;
                submitComplaintBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Mengirim...';

                try {
                    let proofUrl = '';

                    // Upload file if exists
                    if (proofFile) {
                        const storageRef = storage.ref(`complaints/${currentUser.uid}/${Date.now()}_${proofFile.name}`);
                        const snapshot = await storageRef.put(proofFile);
                        proofUrl = await snapshot.ref.getDownloadURL();
                    }

                    const complaintData = {
                        userId: currentUser.uid,
                        userName: userProfile.name,
                        type,
                        title,
                        description,
                        proofUrl,
                        status: 'pending',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    await firestore.collection('complaints').add(complaintData);

                    alert('Pengaduan Anda telah berhasil dikirim!');
                    complaintForm.style.display = 'none';
                    complaintFormData.reset();
                    loadUserComplaints();
                } catch (error) {
                    console.error("Error submitting complaint:", error);
                    alert('Gagal mengirim pengaduan. Silakan coba lagi.');
                } finally {
                    submitComplaintBtn.disabled = false;
                    submitComplaintBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Kirim Pengaduan';
                }
            });

            // Profile form
            profileForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                if (!currentUser || !userProfile) return;

                const newProfile = {
                    name: profileName.value,
                    address: profileAddress.value,
                    phone: profilePhone.value,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                try {
                    // Update Firestore profile
                    await firestore.collection('users').doc(currentUser.uid).update(newProfile);

                    // Update Firebase Auth display name if changed
                    if (newProfile.name !== userProfile.name) {
                        await currentUser.updateProfile({
                            displayName: newProfile.name
                        });

                        userDisplayName.textContent = newProfile.name;
                    }

                    // Update local profile
                    userProfile = { ...userProfile, ...newProfile };

                    alert('Profil Anda telah berhasil diperbarui!');
                } catch (error) {
                    console.error("Error updating profile:", error);
                    alert('Gagal memperbarui profil. Silakan coba lagi.');
                }
            });

            // Cancel profile changes
            cancelProfileBtn.addEventListener('click', () => {
                updateProfileUI(userProfile);
            });

            // Change password
            passwordForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmNewPassword').value;

                if (newPassword !== confirmPassword) {
                    alert('Password baru dan konfirmasi password tidak cocok!');
                    return;
                }

                if (newPassword.length < 6) {
                    alert('Password harus memiliki minimal 6 karakter');
                    return;
                }

                try {
                    // Reauthenticate user
                    const credential = firebase.auth.EmailAuthProvider.credential(
                        currentUser.email,
                        currentPassword
                    );

                    await currentUser.reauthenticateWithCredential(credential);

                    // Update password
                    await currentUser.updatePassword(newPassword);

                    alert('Password Anda telah berhasil diubah!');
                    passwordForm.reset();
                } catch (error) {
                    console.error("Error changing password:", error);

                    if (error.code === 'auth/wrong-password') {
                        alert('Password saat ini salah');
                    } else {
                        alert('Gagal mengubah password. Silakan coba lagi.');
                    }
                }
            });

            // Service card clicks
            document.querySelectorAll('.service-card').forEach(card => {
                card.addEventListener('click', function (e) {
                    // Don't trigger if clicking on a button inside the card
                    if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
                        return;
                    }

                    const service = this.getAttribute('data-service');
                    alert(`Anda memilih layanan: ${service}`);
                    // In a real app, you would navigate to the specific service page
                });
            });

            // Help FAB
            helpFab.addEventListener('click', () => {
                alert('Pusat Bantuan akan membuka panduan penggunaan portal desa');
                // In a real app, this would open a help center modal
            });

            // Change profile photo
            changePhotoBtn.addEventListener('click', () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';

                input.onchange = async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    try {
                        // Upload to Firebase Storage
                        const storageRef = storage.ref(`profile_photos/${currentUser.uid}`);
                        const snapshot = await storageRef.put(file);
                        const photoURL = await snapshot.ref.getDownloadURL();

                        // Update Firebase Auth profile
                        await currentUser.updateProfile({
                            photoURL: photoURL
                        });

                        // Update Firestore profile
                        await firestore.collection('users').doc(currentUser.uid).update({
                            photoURL: photoURL,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });

                        // Update UI
                        userProfileImage.src = photoURL;
                        profilePhoto.src = photoURL;

                        alert('Foto profil berhasil diperbarui!');
                    } catch (error) {
                        console.error("Error updating profile photo:", error);
                        alert('Gagal mengubah foto profil. Silakan coba lagi.');
                    }
                };

                input.click();
            });
        }
    </script>
</body>

</html>